<!doctype html>
<head>
  <meta charset="utf-8">
  <script src="super-agent.js"></script>
  <style>
  #target {
    border: 1px solid #ddd;
  }
  </style>
</head>
<body>
  <h1>Embedding Demo</h1>
  <p>Before</p>
  <div id="target">
  </div>
  <p>After</p>

  <script name="test.js" type="application/super-agent">
    $.onEntry = function (evt) {
      var target = evt.target;
      while (target.tagName !== 'LI') {
        target = target.parentNode;
        if (!target) { return; }
      }
      $.onClick(target.dataset.id);
    };
  </script>

  <script name="test.css" type="application/super-agent">
    li { list-style-type: none; }
    li:hover { background-color: #abf; }
  </script>

  <script name="test.lua" type="application/super-agent">
  return function (update, register)
    register("onClick", function (...)
    end)
    update(nil, {"ul$list", {onclick="onEntry"}})
    scandir("/Users/tim8019/ujkl", function (name, type)
      update("list", {"li", {["data-id"]=name},
        {"span.name",name},
        {"span.type",type},
      })
    end)
  end
  </script>

  <script>
    var domContainer = document.getElementById("target");
    var agentConfig = "ws://localhost:7000/";
    SuperAgent(domContainer, agentConfig, "test");
  </script>
</body>
